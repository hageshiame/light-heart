# 生产级开发排期计划 v1.0

**架构方案**: 本地SQLite + 4核8G服务器混合架构  
**项目周期**: 3周 (15个工作日)  
**团队配置**: 1个全栈前端 + 1个后端  
**成本投入**: 600元/年 (服务器) + 30小时开发  

---

## 第一周：基础设施与设计定案 (Week 1)

### Day 1 (周一) - 文档更新与方案确认

**上午 (4小时)**

| 任务 | 产出 | 负责人 | 优先级 |
|------|------|-------|-------|
| 更新 `TECHNICAL-DECISIONS.md` ADR-008 (混合架构) | 修改后的架构决策文档 | 技术负责人 | P0 |
| 清理过时文档 (LOCAL-SQLITE-ASSESSMENT.md, ARCHITECTURE-MIGRATION-PLAN.md) | 删除或标记为deprecated | 技术负责人 | P1 |
| 核对 `HYBRID-ARCHITECTURE-ASSESSMENT.md` 完整性 | 确保4核8G分析准确 | 技术负责人 | P0 |

**下午 (4小时)**

| 任务 | 产出 | 负责人 | 优先级 |
|------|------|-------|-------|
| 更新 `implementation-guide.md` 第5章 (改为"服务端集成指南") | 修改社交系统为网络接口定义 | 前端负责人 | P0 |
| 生成 `SERVER-DEPLOYMENT-GUIDE.md` (4核8G服务器部署) | 服务器初始化脚本 + 部署清单 | 后端负责人 | P0 |
| 整理 `DATA-SYNC-PROTOCOL.md` (网络协议已完成) | 确认所有API端点定义 | 双方 | P0 |

**当日交付**:
- ✅ 更新的TECHNICAL-DECISIONS.md
- ✅ 更新的implementation-guide.md 第5章
- ✅ 新增的SERVER-DEPLOYMENT-GUIDE.md
- ✅ 确认的数据同步协议v1.0

**团队检查清单**:
- [ ] 架构决策文档已同步
- [ ] 所有API端点后端都理解
- [ ] 服务器部署方案已批准
- [ ] 网络协议无歧义

---

### Day 2 (周二) - 服务器采购与环境搭建

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 购买阿里云轻量服务器 (4核8G) | 服务器IP与SSH密钥 | 1h | P0 |
| Ubuntu 20.04基础配置 | SSH可连接 + 防火墙规则 | 1.5h | P0 |
| Node.js 16+ 与 npm 安装 | `node -v` 验证 | 0.5h | P0 |
| MySQL 5.7 与 Redis 安装 | 两个服务正常运行 | 1.5h | P0 |

**下午 (4小时) - 前端 + 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 前端: 创建Cocos Creator项目骨架 | 基础TypeScript项目配置 | 2h | P0 |
| 后端: 创建Express.js项目骨架 | 路由框架 + 中间件配置 | 1.5h | P0 |
| 双方: Git仓库配置与分支管理 | main + dev分支 + CI/CD基础 | 1.5h | P0 |

**当日交付**:
- ✅ 阿里云服务器可访问
- ✅ Node.js + MySQL + Redis 正常运行
- ✅ 前后端项目骨架已建立
- ✅ Git仓库与CI流程就绪

**验证方式**:
```bash
# 后端验证
$ ssh user@server "node -v && npm -v"
$ ssh user@server "mysql -V && redis-cli ping"

# 前端验证
$ cd frontend && cocos-creator --version

# Git验证
$ git branch -a
```

---

### Day 3 (周三) - 数据库设计与API路由规划

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 设计MySQL表结构 (7个核心表) | SQL DDL脚本 | 2h | P0 |
| 设计Redis缓存策略 | 缓存键设计 + TTL规划 | 1h | P0 |
| 设计API路由表 (见DATA-SYNC-PROTOCOL.md) | Express.js路由框架 | 1h | P0 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 设计本地SQLite表结构 | SQLite DDL脚本 + Typescript类型定义 | 2h | P0 |
| 设计网络请求队列系统 | 优先级分层架构设计 (Layer1-4) | 1.5h | P0 |
| 设计离线缓存策略 | 缓存键设计 + 冲突解决规则 | 0.5h | P0 |

**当日交付**:
- ✅ MySQL DDL脚本 (已验证语法)
- ✅ SQLite DDL脚本 (已验证语法)
- ✅ Express.js路由框架搭建完毕
- ✅ NetworkManager接口设计文档

**代码示例验证**:
```sql
-- MySQL验证
CREATE TABLE accounts (
  id VARCHAR(36) PRIMARY KEY,
  wechat_openid VARCHAR(255) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- SQLite验证
CREATE TABLE characters (
  id TEXT PRIMARY KEY,
  characterId TEXT,
  level INTEGER,
  exp INTEGER
);
```

---

### Day 4-5 (周四-周五) - 核心模块原型

**周四上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现登录API框架 (POST /api/auth/wechat-login) | 能接收请求并返回token | 3h | P0 |
| 实现令牌刷新API | 验证与刷新逻辑 | 1h | P0 |

**周四下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现SQLiteManager类 (增删查改基础) | 能连接数据库 + CRUD操作 | 3h | P0 |
| 实现数据加密模块 (AES-256) | 敏感字段加密成功 | 1h | P0 |

**周五上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现排行榜分数上报接口 (POST /api/leaderboard/submit-score) | 能接收分数 + 基础验证 | 2.5h | P0 |
| 配置Redis排行榜缓存 | 分数能存入Redis | 1.5h | P0 |

**周五下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现NetworkManager核心类 | 能发送HTTP请求 + 错误处理 | 2.5h | P0 |
| 实现网络状态监听 | 能检测WiFi/4G连接 | 1.5h | P0 |

**当日交付**:
- ✅ 登录接口可用
- ✅ SQLiteManager可存取数据
- ✅ NetworkManager能发送请求
- ✅ 排行榜接口接收分数

**单元测试验证**:
```typescript
// 后端
POST /api/auth/wechat-login
{ "code": "test_code" }
→ { "sessionToken": "xxx", "playerId": "yyy" }

// 前端
const db = new SQLiteManager();
db.insertCharacter({ id: 'char_001', level: 10 });
const result = db.queryCharacter('char_001');
expect(result.level).toBe(10);
```

---

**Week 1 总结:**
- ✅ 基础设施完成 (服务器 + 项目骨架)
- ✅ 数据库设计完成
- ✅ 核心模块原型完成
- ✅ 可进入第2周快速迭代
- ⏱️ 工作量: 40小时 (按时)

---

## 第二周：核心功能实现 (Week 2)

### Day 6 (周一) - 排行榜系统完整实现

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现排行榜计算引擎 (每5分钟触发一次) | Cron任务能执行 + Redis排名正确 | 2.5h | P0 |
| 实现GET /api/leaderboard/get-rankings | 能返回正确排名列表 | 1.5h | P0 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现分数提交队列 (Layer 1优先级) | 战斗胜利时自动上报 | 2h | P0 |
| 实现排行榜UI显示 | 能显示服务端返回的排名 | 2h | P0 |

---

### Day 7 (周二) - 救援机制完整实现

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现救援请求创建 (POST /api/rescue/create-request) | 生成救援链接 | 2h | P0 |
| 实现救援任务查询与完成 | 能验证并返还物品 | 2h | P0 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现救援链接分享 | 能生成分享二维码 | 1.5h | P0 |
| 实现救援任务显示与完成UI | 能显示救援任务 + 完成按钮 | 2.5h | P0 |

---

### Day 8 (周三) - 热更新系统

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现配置版本管理接口 (GET /api/config/check-version) | 能返回最新版本 | 1.5h | P0 |
| 实现配置文件下载接口 | 能返回JSON配置 + 校验和 | 1.5h | P0 |
| 配置CDN或静态服务器 (可选) | 配置文件能快速下载 | 1h | P1 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现配置检查与更新 (游戏启动时) | 自动检查新版本 | 2h | P0 |
| 实现配置版本管理 | 能存储本地版本号 + 对比 | 1.5h | P0 |
| 实现更新提示UI | 显示"有新版本"提示 | 0.5h | P0 |

---

### Day 9 (周四) - 数据同步系统

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现批量数据同步接口 (POST /api/sync/batch-data) | 能接收客户端数据 + 存储 | 2h | P0 |
| 实现数据冲突检测与解决 | 服务端版本优先策略 | 1.5h | P0 |
| 实现增量拉取接口 (GET /api/sync/pull-latest) | 能返回增量更新 | 0.5h | P0 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现同步队列系统 (Layer 1-4分层) | 按优先级自动同步 | 2.5h | P0 |
| 实现定时同步任务 (5分钟) | 后台定时触发 | 0.5h | P0 |
| 实现冲突解决UI提示 | 显示"已同步"状态 | 1h | P0 |

---

### Day 10 (周五) - 集成测试与优化

**上午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 前后端完整登录流程测试 | 完整的登录→游戏循环 | 1.5h | P0 |
| 排行榜端到端测试 | 分数上报→显示排名 | 1.5h | P0 |
| 救援机制端到端测试 | 创建→完成→物品返还 | 1h | P0 |

**下午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 网络断线模拟测试 | 断开WiFi→继续游玩→恢复→同步 | 1.5h | P0 |
| 性能基准测试 | 响应时间<200ms, 错误率<1% | 1.5h | P0 |
| Bug修复与优化 | 关键bug清零 | 1h | P0 |

**当日交付**:
- ✅ 排行榜系统完整可用
- ✅ 救援机制完整可用
- ✅ 热更新系统完整可用
- ✅ 数据同步系统完整可用
- ✅ 所有关键功能端到端测试通过
- ✅ 性能指标达标

**验证清单**:
```
排行榜:
  [ ] 分数上报<2秒
  [ ] 排名计算准确
  [ ] Redis缓存命中率>90%
  [ ] 并发100用户无错误

救援:
  [ ] 链接生成<1秒
  [ ] 救援完成验证<3秒
  [ ] 物品返还正确

热更新:
  [ ] 检查版本<1秒
  [ ] 下载配置<5秒
  [ ] 校验和验证正确

数据同步:
  [ ] Layer 1同步<2秒
  [ ] Layer 3同步准确
  [ ] 网络断线无数据丢失
```

**Week 2 总结**:
- ✅ 所有核心功能完成
- ✅ 所有E2E测试通过
- ✅ 性能达到生产标准
- ✅ 可进入第3周上线准备
- ⏱️ 工作量: 40小时 (按时)

---

## 第三周：上线准备与优化 (Week 3)

### Day 11 (周一) - 反作弊与监控部署

**上午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现异常分数检测 (防篡改) | 能检测>150%异常值 | 1.5h | P0 |
| 实现反作弊日志系统 | 可疑行为能记录 | 1.5h | P0 |
| 配置监控告警 (Prometheus/Grafana) | 能监控API延迟 + 错误率 + DB连接 | 1h | P0 |

**下午 (4小时) - 前端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 实现前端完整性校验 (SHA256) | 能检测本地数据篡改 | 2h | P0 |
| 实现自动备份机制 | 每5分钟自动备份到本地 | 1.5h | P0 |
| 实现前端签名验证 (HMAC) | 防止数据被中间人篡改 | 0.5h | P0 |

---

### Day 12 (周二) - 微信审核准备

**上午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 编写用户协议与隐私政策 | 符合微信与GDPR要求 | 1.5h | P0 |
| 检查微信API合规性 | 确保openid使用合规 | 1h | P0 |
| 检查内容合规性 (暴力/色情/广告) | 全部通过 | 0.5h | P0 |
| 配置HTTPS证书 (Let's Encrypt) | 443端口可用 | 1h | P0 |

**下午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 优化包体积 (<30MB) | 删除不必要资源 + 压缩 | 2h | P0 |
| 优化加载速度 (<3秒首屏) | 资源分包 + 预加载优化 | 1.5h | P0 |
| 构建发布包 (v1.0.0) | 签名 + 版本号正确 | 0.5h | P0 |

**当日交付**:
- ✅ 隐私政策与用户协议
- ✅ HTTPS配置完成
- ✅ 发布包已构建
- ✅ 包体积<30MB

---

### Day 13 (周三) - 压力测试与性能优化

**上午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 后端: 压力测试 (100并发用户) | QPS达到2000 | 2h | P0 |
| 后端: 数据库查询优化 | 排行榜查询<100ms | 1.5h | P0 |
| 前端: 内存泄漏检测 | 内存占用稳定<1.2GB | 0.5h | P0 |

**下午 (4小时) - 后端**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 配置服务器自动扩展 (可选) | 监控配置完毕 | 2h | P1 |
| 配置定期备份策略 | 每天自动备份数据库 | 1.5h | P0 |
| 配置日志轮转 | 防止日志占满磁盘 | 0.5h | P0 |

---

### Day 14 (周四) - 文档与培训

**上午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 生成API文档 (Swagger/OpenAPI) | 所有API有文档 | 1h | P0 |
| 生成数据库字典 | 所有表与字段有说明 | 1.5h | P0 |
| 生成部署手册 | 新人能按步骤部署 | 0.5h | P0 |
| 生成故障排查指南 | 常见问题 + 解决方案 | 1h | P0 |

**下午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 知识库整理 | 所有重要决策有记录 | 1.5h | P0 |
| 运维清单编制 | 日常巡检 + 应急响应流程 | 1.5h | P0 |
| 测试报告生成 | 所有测试用例 + 结果 | 1h | P0 |

**当日交付**:
- ✅ 完整的API文档
- ✅ 数据库字典
- ✅ 部署与运维手册
- ✅ 故障排查指南

---

### Day 15 (周五) - 最后验收与上线

**上午 (4小时) - 全团队**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 最终的功能验收 | 所有功能都通过验收 | 1.5h | P0 |
| 最终的安全扫描 (OWASP) | 无严重安全漏洞 | 1.5h | P0 |
| 最终的性能测试 | FPS>=30, 延迟<200ms | 1h | P0 |

**下午 (4小时) - 双方**

| 任务 | 产出 | 时间 | 优先级 |
|------|------|------|-------|
| 提交微信审核 | 审核编号已获得 | 1h | P0 |
| 配置上线监控 (告警规则) | 监控已启动 | 1.5h | P0 |
| 制定应急预案 | 回滚脚本已准备 | 1h | P0 |
| 庆祝 🎉 | 团队回顾 | 0.5h | - |

**当日交付**:
- ✅ 微信审核已提交
- ✅ 监控告警已配置
- ✅ 应急预案已准备
- ✅ 生产环境已就绪

**Week 3 总结**:
- ✅ 反作弊与监控部署完成
- ✅ 微信审核准备完成
- ✅ 压力测试通过
- ✅ 文档与培训完成
- ✅ 应用已上线
- ⏱️ 工作量: 40小时 (按时)

---

## 总结

### 时间投入统计

```
Week 1 (基础设施): 40小时
  - 后端: 20小时 (基础设施 + 数据库设计 + 核心API)
  - 前端: 20小时 (项目搭建 + 本地存储 + 网络层)

Week 2 (核心功能): 40小时
  - 后端: 20小时 (排行榜 + 救援 + 热更新 + 同步)
  - 前端: 20小时 (UI实现 + 功能集成 + 离线支持)

Week 3 (上线准备): 40小时
  - 后端: 20小时 (反作弊 + 监控 + 优化 + 文档)
  - 前端: 20小时 (优化 + 测试 + 文档 + 审核准备)

总计: 120小时 (3周 × 2人 × 20小时/人/周)
```

### 功能完成度

| 功能 | Week1 | Week2 | Week3 | 完成度 |
|------|-------|-------|-------|-------|
| 本地SQLite存储 | ✅ | - | - | 100% |
| 网络同步系统 | ✅ | ✅ | - | 100% |
| 排行榜 | 原型 | ✅ | ✅ | 100% |
| 救援机制 | - | ✅ | ✅ | 100% |
| 热更新配置 | - | ✅ | ✅ | 100% |
| 反作弊系统 | - | - | ✅ | 100% |
| 监控告警 | - | - | ✅ | 100% |

### 风险管理

| 风险 | 影响 | 缓解措施 | 责任人 |
|------|------|--------|-------|
| 前端开发延期 | 整体延期 | 优先完成Layer 1同步逻辑 | 前端负责人 |
| 后端性能不达标 | 无法上线 | Week 3重点优化 + 压力测试 | 后端负责人 |
| 微信审核拒绝 | 延迟上线 | 提前检查内容合规 | 技术负责人 |
| 数据泄露 | 严重事故 | 启用HTTPS + 数据加密 + 安全审计 | 全体 |

### 成功标准

- ✅ 所有功能完成并通过测试
- ✅ 性能指标达到标准:
  - FPS ≥ 30 (中端设备)
  - API延迟 < 200ms
  - 错误率 < 1%
  - 内存占用 < 1.2GB
- ✅ 微信审核通过
- ✅ 游戏能完全离线运行
- ✅ 排行榜与救援机制正常工作
- ✅ 应急预案已准备

### 假设与约束

**假设:**
- 团队成员技能充分 (TypeScript + Node.js + Cocos Creator)
- 没有重大需求变更
- 微信审核在3周内通过
- 阿里云服务器性能正常

**约束:**
- 4核8G服务器: 日活<=500, QPS<=300
- Spine骨骼数: <=60根
- 包体积: <=30MB
- 首屏加载: <3秒

---

## 检查清单 (Go/No-Go)

**Week 1完成:**
- [ ] TECHNICAL-DECISIONS.md已更新
- [ ] implementation-guide.md第5章已更新
- [ ] SERVER-DEPLOYMENT-GUIDE.md已创建
- [ ] 阿里云服务器已可用
- [ ] Node.js + MySQL + Redis已安装
- [ ] 前后端项目骨架已建立
- [ ] SQLiteManager能CRUD
- [ ] NetworkManager能发送请求
- [ ] 登录接口可用
- [ ] 排行榜接口接收分数

**Week 2完成:**
- [ ] 排行榜系统全功能可用
- [ ] 救援机制全功能可用
- [ ] 热更新系统全功能可用
- [ ] 数据同步系统全功能可用
- [ ] 所有E2E测试通过
- [ ] 性能指标达标
- [ ] 网络断线测试通过

**Week 3完成:**
- [ ] 反作弊系统已部署
- [ ] 监控告警已配置
- [ ] 微信审核已提交
- [ ] 包体积<30MB
- [ ] 文档完整
- [ ] 应急预案已准备

---

**版本**: 1.0  
**更新时间**: 2025-12-26  
**下一次评审**: Week 1完成时
